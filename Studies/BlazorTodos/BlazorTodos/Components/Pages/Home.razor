@page "/"
@using System.Collections
@using BlazorTodos.Models
@rendermode InteractiveServer
@inject ITodoService TodoService

<MudThemeProvider/>
<PageTitle>Home</PageTitle>
<br />
<br />
<br />
@if (_error)
{
    <MudAlert Severity="Severity.Warning">@_ErrorMessage</MudAlert>
}
else
{
    <MudGrid>
        @if(Todos != null)
        {
            
            @foreach (var t in Todos)
            {
                <MudItem xs="4" sm="4" Style="height: 500px; overflow-y: auto;">
                   
                    <MudCard Style="background-color : lightyellow">
                        <MudCardHeader>
                            <CardHeaderContent>
                                <MudText Typo="Typo.h6">@t.Title</MudText>
                                <MudSpacer />
                                @if (t.IsDone)
                                {
                                    <MudChip T="string" Color="Color.Success">Concluída</MudChip>
                                }
                                else
                                {
                                    <MudChip T="string" Color="Color.Warning">Pendente</MudChip>
                                }
                            </CardHeaderContent>
                            <CardHeaderActions>
                                <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Default" />
                            </CardHeaderActions>
                        </MudCardHeader>
                        <MudCardContent>
                            <MudText>@t.Description</MudText>
                            @if (t.EndLine != DateTime.Today.ToUniversalTime())
                            {
                                <MudText Typo="Typo.body2" Color="@Color.Warning">Deadline:<MudText Color="@Color.Primary">@t.EndLine.ToString("dd/MM/yyyy")</MudText></MudText>
                            }
                            <MudSpacer />
                            <MudText Typo="Typo.body2" Color="@Color.Dark">Criada em:<MudText Color="@Color.Primary">@t.CreationDate.ToString("dd/MM/yyyy")</MudText></MudText>

                        </MudCardContent>
                        <MudCardActions>
                            <MudButton Variant="Variant.Text" Color="Color.Primary">Edit</MudButton>
                        </MudCardActions>
                    </MudCard>
                </MudItem>
            }
            
        }
        else
        {
            _error = true;
        }
    </MudGrid>
}

@code{
    private IEnumerable<Todo> Todos;
    private string _ErrorMessage;
    private bool _error;

    protected async override Task OnInitializedAsync()
    {

        try
        {
            _ErrorMessage = "Nenhuma tarefa cadastrada.";
            Todos = new List<Todo>();
            Todos = await TodoService.GetAllTodos();
            StateHasChanged();
        }
        catch(Exception ex)
        {
            _error = true;
            _ErrorMessage = ex.Message + " - " + ex.InnerException.Message;
        }
    }

}
