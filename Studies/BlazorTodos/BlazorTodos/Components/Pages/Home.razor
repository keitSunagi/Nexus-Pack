@page "/"
@using System.Collections
@using BlazorTodos.Models
@rendermode InteractiveServer
@inject ITodoService TodoService

<MudThemeProvider/>
<MudPopoverProvider />
<MudDialogProvider />
<PageTitle>Home</PageTitle>
<br />
<br />
<br />
@if (_error)
{
    <MudAlert Severity="Severity.Warning">@_ErrorMessage</MudAlert>
}
else
{
    <MudGrid>
        @if(Todos != null)
        { 
            @foreach (var t in Todos)
            {
                <MudItem xs="4" sm="4" Style="height: 500px; overflow-y: auto;">
                    <CardComponent ThisTodo="t" OnTodoDeleted="LoadData" /> 
                </MudItem>
            } 
        }
        else
        {
            _error = true;
        }
    </MudGrid>
}

@code{
    private IEnumerable<Todo> Todos;
    private string _ErrorMessage;
    private bool _error;

    private async Task LoadData()
    {
        try
        {
            _ErrorMessage = "Nenhuma tarefa cadastrada.";
            Todos = new List<Todo>();
            Todos = await TodoService.GetAllTodos();
            StateHasChanged();
        }
        catch (Exception ex)
        {
            _error = true;
            _ErrorMessage = ex.Message;
        }
    }

    protected async override Task OnInitializedAsync()
    {
       await LoadData();
    }

}
